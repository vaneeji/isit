<div class="container">
    <h1>üè™ –ù–∞—à–∏ –º–∞–≥–∞–∑–∏–Ω—ã</h1>

    <div id="shops-list">
        {% for shop in shops %}
            <div class="shop">
                <div class="shop-header"
                     onclick="toggleProducts({{ shop.id }})"
                     style="cursor: pointer;"
                     id="shop-header-{{ shop.id }}">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <span style="font-size: 1.5rem;">üè™</span>
                        <div>
                            <div style="font-size: 1.2rem; font-weight: 600; color: #333;">
                                {{ shop.name }}
                            </div>
                            <div style="color: #666; font-size: 0.9rem; font-weight: 400;">
                                üìç {{ shop.location }}
                            </div>
                        </div>
                    </div>
                    <span id="arrow-{{ shop.id }}" class="arrow">‚ñ∂</span>
                </div>

                <ul id="products-{{ shop.id }}" style="display: none; margin-top: 1rem; padding: 1rem; background: rgba(102, 126, 234, 0.05); border-radius: 10px;"></ul>

                <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                    <form method="post"
                          hx-post="{% url 'delete_shop_partial' shop.id %}"
                          hx-target="#shops-list"
                          hx-swap="outerHTML"
                          hx-confirm="–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –º–∞–≥–∞–∑–∏–Ω '{{ shop.name }}'?"
                          style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="button danger" style="padding: 0.5rem 1rem; font-size: 0.9rem;">
                            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </form>
                </div>
            </div>
        {% empty %}
            <div style="text-align: center; padding: 4rem; color: #999; font-size: 1.2rem;">
                <div style="font-size: 4rem; margin-bottom: 1rem;">üè™</div>
                <p>–ú–∞–≥–∞–∑–∏–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                <a hx-get="{% url 'add_shop_partial' %}"
                   hx-target="#main-content"
                   hx-swap="innerHTML"
                   class="button"
                   style="margin-top: 1rem;">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π –º–∞–≥–∞–∑–∏–Ω
                </a>
            </div>
        {% endfor %}
    </div>

    <div style="text-align: center; margin-top: 2rem;">
        <a hx-get="{% url 'add_shop_partial' %}"
           hx-target="#main-content"
           hx-swap="innerHTML"
           class="button">
            ‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –º–∞–≥–∞–∑–∏–Ω
        </a>
    </div>
</div>

<script>
    function toggleProducts(shopId) {
        const list = document.getElementById('products-' + shopId);
        const arrow = document.getElementById('arrow-' + shopId);

        if (list.style.display === 'none') {
            list.style.display = 'block';
            arrow.textContent = '‚ñº';
            arrow.style.transform = 'rotate(90deg)';

            if (list.innerHTML.trim() === '') {
                list.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</div>';
                htmx.ajax('GET', `/shops/${shopId}/products/`, {
                    target: list,
                    swap: 'innerHTML'
                });
            }
        } else {
            list.style.display = 'none';
            arrow.textContent = '‚ñ∂';
            arrow.style.transform = 'rotate(0deg)';
        }
    }
</script>